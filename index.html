<!DOCTYPE html>
<html>
	<head>
		<title>platformer.js demo</title>
	</head>
	<body>
		<canvas id="platformerDebug" width="1280" height="720"></canvas>
		<script type="text/javascript" src="gl-matrix.js"></script>
		<script type="text/javascript" src="platformer.js"></script>
		<script type="text/javascript">
			var world = new platformer.World()
			
			var platform = world.createPlatform({size: [2, 1], position: [0, 1.4]})
			world.createPlatform({size: [2, 1], position: [2, 0]})
			world.createPlatform({size: [1, 1], position: [2, 1]})
			world.createPlatform({size: [100, 0.2], position: [-50, 0]})
			
			var player = world.createPlayer({size: [0.4, 1], position: [0.5, 2]})
			
			var leftPressed = false
			var rightPressed = false
			
			window.onkeydown = function(event)
			{
				if (event.keyCode == 37) // left
					leftPressed = true
				else if (event.keyCode == 39) // right
					rightPressed = true
				
				if ((event.keyCode == 32) && player.grounded) // space
					player.jump()
			}
			
			window.onkeyup = function(event)
			{
				if (event.keyCode == 37) // left
					leftPressed = false
				else if (event.keyCode == 39) // right
					rightPressed = false
			}
			
			var canvas = document.getElementById("platformerDebug")
			world.enableDebug(canvas)
			
			var currentTime = null
			function render(timestamp)
			{
				timestamp *= 0.001 // milliseconds to seconds
				
				var dt = 0
				if (currentTime != null)
					dt = timestamp - this.currentTime
				currentTime = timestamp
				
				var move = 0
				if (leftPressed) move -= 1
				if (rightPressed) move += 1
				player.moveHorizontally(move)
				
				navigator.getGamepads = navigator.getGamepads || navigator.webkitGetGamepads
				var gamepads = navigator.getGamepads()
				if ((gamepads.length > 0) && gamepads[0])
				{
					var pad = gamepads[0]
					player.moveHorizontally(pad.axes[0])
					
					if (pad.buttons[0].pressed && player.grounded)
						player.jump()
				}
				
				platform.position[1] = Math.sin(currentTime) * 2
				
				world.update(dt)
				
				requestAnimationFrame(render)
			}
			
			requestAnimationFrame(render)
		</script>
	</body>
</html>
